<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Extending Nikola | Antipodae</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (fr)" href="../../fr/rss.xml">
<link rel="canonical" href="http://antipodae.fr/stories/extending/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Playfair+Display%7CRaleway:200,400,700" rel="stylesheet">
<link href="../../assets/css/sharrre.css" rel="stylesheet" type="text/css">
<meta name="author" content="The Nikola Team">
<meta property="og:site_name" content="Antipodae">
<meta property="og:title" content="Extending Nikola">
<meta property="og:url" content="http://antipodae.fr/stories/extending/">
<meta property="og:description" content="Extending Nikola




Version:7.7.12

Author:Roberto Alsina &lt;ralsina@netmanagers.com.ar&gt;




Con­tents 
 
Ex­tend­ing Niko­la 
 Com­­mand Plug­ins  
  Tem­­plateSys­tem Plug­ins  
  Task Plug­ins  
  P">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2012-03-30T23:00:00-03:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@antipodaefr">
<meta name="twitter:creator" content="@antipodaefr">
<link rel="alternate" hreflang="fr" href="../../fr/stories/extending/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://antipodae.fr/">
                <img src="../../images/logo150.png" alt="Antipodae" id="logo"></a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../rss.xml">RSS&nbsp;feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
            </li>
<li><a href="http://antipodae.fr/fr/" rel="alternate" hreflang="fr">Français</a></li>

                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Extending&nbsp;Nikola</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="section" id="extending-nikola">
<h2><a class="toc-backref" href="#id1">Extending&nbsp;Nikola</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field">
<th class="field-name">Version:</th>
<td class="field-body">7.7.12</td>
</tr>
<tr class="field">
<th class="field-name">Author:</th>
<td class="field-body">Roberto Alsina &lt;<a class="reference external" href="mailto:ralsina@netmanagers.com.ar">ralsina@netmanagers.com.ar</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="contents alert alert-info pull-right topic" id="contents">
<p class="topic-title first">Con­tents</p> 
 <ul class="simple">
<li>
<a class="reference internal" href="#extending-nikola" id="id1">Ex­tend­ing Niko­la</a><ul>
<li><a class="reference internal" href="#command-plugins" id="id2">Com­­mand&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#templatesystem-plugins" id="id3">Tem­­plateSys­tem&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#task-plugins" id="id4">Task&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#pagecompiler-plugins" id="id5">Page­­Com­pil­er&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#restextension-plugins" id="id6">Res­­tEx­ten­­sion&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#markdownextension-plugins" id="id7">Mark­­downEx­ten­­sion&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#signalhandler-plugins" id="id8">Sig­­nal­Han­dler&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#configplugin-plugins" id="id9">Con­­fig­­Plu­g­in&nbsp;Plug­ins</a></li>  
  <li><a class="reference internal" href="#postscanner-plugins" id="id10">PostScan­n­er&nbsp;Plug­ins</a></li>  
  </ul>
</li> 
 <li><a class="reference internal" href="#plugin-index" id="id11">Plug­in&nbsp;In­dex</a></li> 
 <li><a class="reference internal" href="#path-link-resolution-mechanism" id="id12">Path/Link Res­o­lu­tion&nbsp;Mech­a­nism</a></li> 
 <li><a class="reference internal" href="#template-hooks" id="id13">Tem­plate&nbsp;Hooks</a></li> 
 <li>
<a class="reference internal" href="#shortcodes" id="id14">Short­codes</a><ul>
<li><a class="reference internal" href="#template-based-shortcodes" id="id15">Tem­­plate-based&nbsp;Short­­­codes</a></li>  
  </ul>
</li> 
 <li><a class="reference internal" href="#state-and-cache" id="id16">State and&nbsp;Cache</a></li> 
 </ul>
</div>
<p class="lead">Niko­la is ex­ten­si­ble. Al­most all its func­tion­al­i­ty is based on plu­g­in­s,
and you can add your own or re­place the pro­vid­ed&nbsp;ones.</p> 
 <p>Plug­ins con­sist of a meta­da­ta file (with  <tt class="docutils literal">.plug­in</tt>  ex­ten­sion) and
a Python mod­ule (a  <tt class="docutils literal">.py</tt>  file) or pack­age (a fold­er con­tain­ing
a  <tt class="docutils literal">__init__.py</tt>  file.</p> 
 <p>To use a plug­in in your site, you just have to put it in a  <tt class="docutils literal">plug­ins</tt> 
fold­er in your&nbsp;site.</p> 
 <p>Plug­ins come in var­i­ous flavours, aimed at ex­tend­ing dif­fer­ent as­pect­s
of&nbsp;Niko­la.</p> 
 <div class="section" id="command-plugins">
<h3><a class="toc-backref" href="#id2">Command&nbsp;Plugins</a></h3>
<p>When you run  <tt class="docutils literal">niko­la  <span class="pre">--help</span></tt>  you will see some­thing like&nbsp;this:</p> 
 <pre class="code console"><a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-1"></a><span class="gp">$</span> nikola <span class="nb">help</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-2"></a><span class="go">Nikola is a tool to create static websites and blogs. For full documentation and more</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-3"></a><span class="go">information, please visit https://getnikola.com/</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-4"></a>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-5"></a>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-6"></a><span class="go">Available commands:</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-7"></a><span class="go">nikola auto                 automatically detect site changes, rebuild</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-8"></a><span class="go">                            and optionally refresh a browser</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-9"></a><span class="go">nikola bootswatch_theme     given a swatch name from bootswatch.com and a</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-10"></a><span class="go">                            parent theme, creates a custom theme</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-11"></a><span class="go">nikola build                run tasks</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-12"></a><span class="go">nikola check                check links and files in the generated site</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-13"></a><span class="go">nikola clean                clean action / remove targets</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-14"></a><span class="go">nikola console              start an interactive python console with access to</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-15"></a><span class="go">                            your site and configuration</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-16"></a><span class="go">nikola deploy               deploy the site</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-17"></a><span class="go">nikola dumpdb               dump dependency DB</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-18"></a><span class="go">nikola forget               clear successful run status from internal DB</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-19"></a><span class="go">nikola help                 show help</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-20"></a><span class="go">nikola ignore               ignore task (skip) on subsequent runs</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-21"></a><span class="go">nikola import_blogger       import a blogger dump</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-22"></a><span class="go">nikola import_feed          import a RSS/Atom dump</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-23"></a><span class="go">nikola import_wordpress     import a WordPress dump</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-24"></a><span class="go">nikola init                 create a Nikola site in the specified folder</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-25"></a><span class="go">nikola list                 list tasks from dodo file</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-26"></a><span class="go">nikola mincss               apply mincss to the generated site</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-27"></a><span class="go">nikola new_post             create a new blog post or site page</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-28"></a><span class="go">nikola run                  run tasks</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-29"></a><span class="go">nikola serve                start the test webserver</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-30"></a><span class="go">nikola strace               use strace to list file_deps and targets</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-31"></a><span class="go">nikola theme                manage themes</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-32"></a><span class="go">nikola version              print the Nikola version number</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-33"></a>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-34"></a><span class="go">nikola help                 show help / reference</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-35"></a><span class="go">nikola help &lt;command&gt;       show command usage</span>
<a name="rest_code_e5fe3eea38604a78b3b8ebffa0141763-36"></a><span class="go">nikola help &lt;task-name&gt;     show task usage</span>
</pre>
<p>That will give you a list of all avail­able com­mands in your ver­sion of Niko­la.
Each and ev­ery one of those is a plug­in. Let&#8217;s look at a typ­i­cal&nbsp;ex­am­ple:</p> 
 <p>First, the  <tt class="docutils literal">serve.­plug­in</tt>  file:</p> 
 <pre class="code ini"><a name="rest_code_99c92d008891454899b551154685d57b-1"></a><span class="k">[Core]</span>
<a name="rest_code_99c92d008891454899b551154685d57b-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">serve</span>
<a name="rest_code_99c92d008891454899b551154685d57b-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">serve</span>
<a name="rest_code_99c92d008891454899b551154685d57b-4"></a>
<a name="rest_code_99c92d008891454899b551154685d57b-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_99c92d008891454899b551154685d57b-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_99c92d008891454899b551154685d57b-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_99c92d008891454899b551154685d57b-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_99c92d008891454899b551154685d57b-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Start test server.</span>
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p> 
 <p class="last">If you want to pub­lish your plug­in on the Plug­in In­dex,  <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read­
the docs for the In­dex</a> 
(and the .plug­in file ex­am­ples and&nbsp;ex­pla­na­tion­s).</p> 
 </div>
<p>For your own plug­in, just change the val­ues in a sen­si­ble way. The
 <tt class="docutils literal">Mod­ule</tt>  will be used to find the match­ing Python mod­ule, in this case
 <tt class="docutils literal">serve.py</tt>, from which this is the in­ter­est­ing&nbsp;bit:</p> 
 <pre class="code python"><a name="rest_code_783a4053165947c9a49729578b5734f8-1"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">Command</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-2"></a>
<a name="rest_code_783a4053165947c9a49729578b5734f8-3"></a><span class="c1"># You have to inherit Command for this to be a</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-4"></a><span class="c1"># command plugin:</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-5"></a>
<a name="rest_code_783a4053165947c9a49729578b5734f8-6"></a><span class="k">class</span> <span class="nc">CommandServe</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-7"></a>    <span class="sd">"""Start test server."""</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-8"></a>
<a name="rest_code_783a4053165947c9a49729578b5734f8-9"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s2">"serve"</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-10"></a>    <span class="n">doc_usage</span> <span class="o">=</span> <span class="s2">"[options]"</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-11"></a>    <span class="n">doc_purpose</span> <span class="o">=</span> <span class="s2">"start the test webserver"</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-12"></a>
<a name="rest_code_783a4053165947c9a49729578b5734f8-13"></a>    <span class="n">cmd_options</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-14"></a>        <span class="p">{</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-15"></a>            <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'port'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-16"></a>            <span class="s1">'short'</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-17"></a>            <span class="s1">'long'</span><span class="p">:</span> <span class="s1">'port'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-18"></a>            <span class="s1">'default'</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-19"></a>            <span class="s1">'type'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-20"></a>            <span class="s1">'help'</span><span class="p">:</span> <span class="s1">'Port number (default: 8000)'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-21"></a>        <span class="p">},</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-22"></a>        <span class="p">{</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-23"></a>            <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'address'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-24"></a>            <span class="s1">'short'</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-25"></a>            <span class="s1">'long'</span><span class="p">:</span> <span class="s1">'--address'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-26"></a>            <span class="s1">'type'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-27"></a>            <span class="s1">'default'</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-28"></a>            <span class="s1">'help'</span><span class="p">:</span> <span class="s1">'Address to bind (default: 127.0.0.1)'</span><span class="p">,</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-29"></a>        <span class="p">},</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-30"></a>    <span class="p">)</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-31"></a>
<a name="rest_code_783a4053165947c9a49729578b5734f8-32"></a>    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-33"></a>        <span class="sd">"""Start test server."""</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-34"></a>        <span class="n">out_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'OUTPUT_FOLDER'</span><span class="p">]</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-35"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-36"></a>            <span class="k">print</span><span class="p">(</span><span class="s2">"Error: Missing '{0}' folder?"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_dir</span><span class="p">))</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-37"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-38"></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-39"></a>            <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">options</span><span class="p">[</span><span class="s1">'address'</span><span class="p">],</span> <span class="n">options</span><span class="p">[</span><span class="s1">'port'</span><span class="p">]),</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-40"></a>                            <span class="n">OurHTTPRequestHandler</span><span class="p">)</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-41"></a>            <span class="n">sa</span> <span class="o">=</span> <span class="n">httpd</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-42"></a>            <span class="k">print</span><span class="p">(</span><span class="s2">"Serving HTTP on"</span><span class="p">,</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"port"</span><span class="p">,</span> <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"..."</span><span class="p">)</span>
<a name="rest_code_783a4053165947c9a49729578b5734f8-43"></a>            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre>
<p>As men­tioned above, a plug­in can have op­tion­s, which the us­er can see by do­ing
 <tt class="docutils literal">niko­la help com­mand</tt>  and can lat­er use, for&nbsp;ex­am­ple:</p> 
 <pre class="code console"><a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-1"></a><span class="gp">$</span> nikola <span class="nb">help</span> serve
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-2"></a><span class="go">Purpose: start the test webserver</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-3"></a><span class="go">Usage:   nikola serve [options]</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-4"></a>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-5"></a><span class="go">Options:</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-6"></a><span class="go">-p ARG, --port=ARG        Port number (default: 8000)</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-7"></a><span class="go">-a ARG, ----address=ARG   Address to bind (default: 127.0.0.1)</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-8"></a>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-9"></a><span class="gp">$</span> nikola serve -p <span class="m">9000</span>
<a name="rest_code_6e93cc1586b54cfaae32af619b11ef52-10"></a><span class="go">Serving HTTP on 127.0.0.1 port 9000 ...</span>
</pre>
<p>So, what can you do with com­mand­s? Well, any­thing you wan­t, re­al­ly. I have im­ple­ment­ed
a sort of plan­et us­ing it. So, be cre­ative, and if you do some­thing in­ter­est­ing,
let me know&nbsp;;-)</p> 
 </div>
<div class="section" id="templatesystem-plugins">
<h3><a class="toc-backref" href="#id3">TemplateSystem&nbsp;Plugins</a></h3>
<p>Niko­la sup­ports Mako and Jin­ja2. If you pre­fer some oth­er tem­plat­ing
sys­tem, then you will have to write a  <tt class="docutils literal">Tem­plateSys­tem</tt>  plug­in. Here&#8217;s how they work.
­First, you have to cre­ate a  <tt class="docutils literal">.plug­in</tt>  file. Here&#8217;s the one for the Mako&nbsp;plug­in:</p> 
 <pre class="code ini"><a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-1"></a><span class="k">[Core]</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">mako</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">mako</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-4"></a>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_c11cfcbe133e4daaaa44272d644d1cc9-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Support for Mako templates.</span>
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p> 
 <p class="last">If you want to pub­lish your plug­in on the Plug­in In­dex,  <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read­
the docs for the In­dex</a> 
(and the .plug­in file ex­am­ples and&nbsp;ex­pla­na­tion­s).</p> 
 </div>
<p>You will have to re­place &#8220;mako&#8221; with your tem­plate sys­tem&#8217;s name, and oth­er data
in the ob­vi­ous&nbsp;ways.</p> 
 <p>The &#8220;Mod­ule&#8221; op­tion is the name of the mod­ule, which has to look some­thing like this,
a stub for a hy­po­thet­i­cal sys­tem called&nbsp;&#8220;Tem­plater&#8221;:</p> 
 <pre class="code python"><a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-1"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">TemplateSystem</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-2"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-3"></a><span class="c1"># You have to inherit TemplateSystem</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-4"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-5"></a><span class="k">class</span> <span class="nc">TemplaterTemplates</span><span class="p">(</span><span class="n">TemplateSystem</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-6"></a>    <span class="sd">"""Wrapper for Templater templates."""</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-7"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-8"></a>    <span class="c1"># name has to match Name in the .plugin file</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-9"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s2">"templater"</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-10"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-11"></a>    <span class="c1"># A list of directories where the templates will be</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-12"></a>    <span class="c1"># located. Most template systems have some sort of</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-13"></a>    <span class="c1"># template loading tool that can use this.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-14"></a>    <span class="k">def</span> <span class="nf">set_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directories</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-15"></a>        <span class="sd">"""Sets the list of folders where templates are located and cache."""</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-16"></a>        <span class="k">pass</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-17"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-18"></a>    <span class="c1"># You *must* implement this, even if to return []</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-19"></a>    <span class="c1"># It should return a list of all the files that,</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-20"></a>    <span class="c1"># when changed, may affect the template's output.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-21"></a>    <span class="c1"># usually this involves template inheritance and</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-22"></a>    <span class="c1"># inclusion.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-23"></a>    <span class="k">def</span> <span class="nf">template_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-24"></a>        <span class="sd">"""Returns filenames which are dependencies for a template."""</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-25"></a>        <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-26"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-27"></a>    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-28"></a>        <span class="sd">"""Renders template to a file using context.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-29"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-30"></a><span class="sd">        This must save the data to output_name *and* return it</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-31"></a><span class="sd">        so that the caller may do additional processing.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-32"></a><span class="sd">        """</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-33"></a>        <span class="k">pass</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-34"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-35"></a>    <span class="c1"># The method that does the actual rendering.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-36"></a>    <span class="c1"># template_name is the name of the template file,</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-37"></a>    <span class="c1"># context is a dictionary containing the data the template</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-38"></a>    <span class="c1"># uses for rendering.</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-39"></a>    <span class="k">def</span> <span class="nf">render_template_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-40"></a>        <span class="sd">"""Renders template to a string using context. """</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-41"></a>        <span class="k">pass</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-42"></a>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-43"></a>    <span class="k">def</span> <span class="nf">inject_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-44"></a>        <span class="sd">"""Injects the directory with the lowest priority in the</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-45"></a><span class="sd">        template search mechanism."""</span>
<a name="rest_code_d08ffd89099847e9a66a2d0ec38e5ea9-46"></a>        <span class="k">pass</span>
</pre>
<p>You can see a re­al ex­am­ple in  <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/template/jinja.py">the Jin­ja&nbsp;plug­in</a></p> 
 </div>
<div class="section" id="task-plugins">
<h3><a class="toc-backref" href="#id4">Task&nbsp;Plugins</a></h3>
<p>If you want to do some­thing that de­pends on the da­ta in your site, you
prob­a­bly want to do a  <tt class="docutils literal">Task</tt>  plug­in, which will make it be part of the
 <tt class="docutils literal">niko­la build</tt>  com­mand. These are the cur­rent­ly avail­able tasks, al­l
pro­vid­ed by&nbsp;plu­g­in­s:</p> 
 <div class="sidebar">
<p class="first sidebar-title">Oth­er&nbsp;Tasks</p> 
 <p class="last">There are al­so  <tt class="docutils literal">Late­Task</tt>  plu­g­in­s, which are ex­e­cut­ed lat­er,
and  <tt class="docutils literal">Task­Mul­ti­pli­er</tt>  plug­ins that take a task and cre­ate
­more tasks out of&nbsp;it.</p> 
 </div>
<pre class="code console"><a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-1"></a><span class="gp">$</span> nikola list
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-2"></a><span class="go">Scanning posts....done!</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-3"></a><span class="go">build_bundles</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-4"></a><span class="go">build_less</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-5"></a><span class="go">copy_assets</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-6"></a><span class="go">copy_files</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-7"></a><span class="go">post_render</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-8"></a><span class="go">redirect</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-9"></a><span class="go">render_archive</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-10"></a><span class="go">render_galleries</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-11"></a><span class="go">render_galleries_clean</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-12"></a><span class="go">render_indexes</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-13"></a><span class="go">render_listings</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-14"></a><span class="go">render_pages</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-15"></a><span class="go">render_posts</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-16"></a><span class="go">render_rss</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-17"></a><span class="go">render_site</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-18"></a><span class="go">render_sources</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-19"></a><span class="go">render_tags</span>
<a name="rest_code_12d51b0be4bf4f22b68f09d6b489de6c-20"></a><span class="go">sitemap</span>
</pre>
<p>These have ac­cess to the  <tt class="docutils literal">site</tt>  ob­ject which con­tains your time­line and
y­our&nbsp;con­fig­u­ra­tion.</p> 
 <p>The crit­i­cal bit of Task plug­ins is their  <tt class="docutils literal">gen_­tasks</tt>  method, which  <tt class="docutils literal">yields</tt> 
 <a class="reference external" href="http://pydoit.org/tasks.html">doit tasks</a>.</p> 
 <p>The de­tails of how to han­dle de­pen­den­cies, etc., are a bit too much for this
­doc­u­men­t, so I&#8217;ll just leave you with an ex­am­ple, the  <tt class="docutils literal">copy­_as­sets</tt>  task.
­First the  <tt class="docutils literal">task_­copy­_as­set­s.­plug­in</tt>  file, which you should copy and ed­it
in the log­i­cal&nbsp;ways:</p> 
 <pre class="code ini"><a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-1"></a><span class="k">[Core]</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">copy_assets</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">task_copy_assets</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-4"></a>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_bf9bc491fef24daf8af39f3b20c1723a-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Copy theme assets into output.</span>
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p> 
 <p class="last">If you want to pub­lish your plug­in on the Plug­in In­dex,  <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read­
the docs for the In­dex</a> 
(and the .plug­in file ex­am­ples and&nbsp;ex­pla­na­tion­s).</p> 
 </div>
<p>And the  <tt class="docutils literal">task_­copy­_as­set­s.py</tt>  file, in its&nbsp;en­tire­ty:</p> 
 <pre class="code python"><a name="rest_code_e35e20b913a54551b955e23b97172f0a-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-2"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-3"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">Task</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-4"></a><span class="kn">from</span> <span class="nn">nikola</span> <span class="kn">import</span> <span class="n">utils</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-5"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-6"></a><span class="c1"># Have to inherit Task to be a task plugin</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-7"></a><span class="k">class</span> <span class="nc">CopyAssets</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-8"></a>    <span class="sd">"""Copy theme assets into output."""</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-9"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-10"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s2">"copy_assets"</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-11"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-12"></a>    <span class="c1"># This yields the tasks</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-13"></a>    <span class="k">def</span> <span class="nf">gen_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-14"></a>        <span class="sd">"""Create tasks to copy the assets of the whole theme chain.</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-15"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-16"></a><span class="sd">        If a file is present on two themes, use the version</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-17"></a><span class="sd">        from the "youngest" theme.</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-18"></a><span class="sd">        """</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-19"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-20"></a>        <span class="c1"># I put all the configurations and data the plugin uses</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-21"></a>        <span class="c1"># in a dictionary because utils.config_changed will</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-22"></a>        <span class="c1"># make it so that if these change, this task will be</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-23"></a>        <span class="c1"># marked out of date, and run again.</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-24"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-25"></a>        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-26"></a>            <span class="s2">"themes"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">THEMES</span><span class="p">,</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-27"></a>            <span class="s2">"output_folder"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'OUTPUT_FOLDER'</span><span class="p">],</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-28"></a>            <span class="s2">"filters"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'FILTERS'</span><span class="p">],</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-29"></a>        <span class="p">}</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-30"></a>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-31"></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-32"></a>        <span class="k">for</span> <span class="n">theme_name</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">[</span><span class="s1">'themes'</span><span class="p">]:</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-33"></a>            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_theme_path</span><span class="p">(</span><span class="n">theme_name</span><span class="p">),</span> <span class="s1">'assets'</span><span class="p">)</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-34"></a>            <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">'output_folder'</span><span class="p">],</span> <span class="s1">'assets'</span><span class="p">)</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-35"></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-36"></a>                <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-37"></a>                    <span class="k">continue</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-38"></a>                <span class="n">tasks</span><span class="p">[</span><span class="n">task</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">task</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-39"></a>                <span class="n">task</span><span class="p">[</span><span class="s1">'uptodate'</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'uptodate'</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> \
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-40"></a>                    <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">config_changed</span><span class="p">(</span><span class="n">kw</span><span class="p">)]</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-41"></a>                <span class="n">task</span><span class="p">[</span><span class="s1">'basename'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-42"></a>                <span class="c1"># If your task generates files, please do this.</span>
<a name="rest_code_e35e20b913a54551b955e23b97172f0a-43"></a>                <span class="k">yield</span> <span class="n">utils</span><span class="o">.</span><span class="n">apply_filters</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s1">'filters'</span><span class="p">])</span>
</pre>
</div>
<div class="section" id="pagecompiler-plugins">
<h3><a class="toc-backref" href="#id5">PageCompiler&nbsp;Plugins</a></h3>
<p>These plug­ins im­ple­ment markup lan­guages, they take sources for posts or pages and
cre­ate HTML or oth­er out­put files. A good ex­am­ple is  <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v7/misaka">the mis­a­ka&nbsp;plug­in.</a></p> 
 <p>They must&nbsp;provide:</p> 
 <dl class="docutils">
<dt><tt class="docutils literal">compile_html</tt></dt>
<dd>Function that builds a&nbsp;file.</dd>
<dt><tt class="docutils literal">create_post</tt></dt>
<dd>Function that creates an empty file with some metadata in&nbsp;it.</dd>
</dl>
<p>If the com­pil­er pro­duces some­thing oth­er than HTML files, it should al­so im­ple­ment  <tt class="docutils literal">ex­ten­sion</tt>  which
re­turns the pre­ferred ex­ten­sion for the out­put&nbsp;file.</p> 
 <p>These plug­ins can al­so be used to ex­tract meta­da­ta from a file. To do so, the
­plu­g­in may im­ple­ment  <tt class="docutils literal">read­_meta­da­ta</tt>  that will re­turn a dict con­tain­ing the
meta­da­ta con­tained in the&nbsp;file.</p> 
 </div>
<div class="section" id="restextension-plugins">
<h3><a class="toc-backref" href="#id6">RestExtension&nbsp;Plugins</a></h3>
<p>Im­ple­ment di­rec­tives for re­Struc­tured­Tex­t, see  <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/compile/rest/media.py">me­di­a.py</a>  for a sim­ple&nbsp;ex­am­ple.</p> 
 <p>If your out­put de­pends on a con­fig val­ue, you need to make your post record a
de­pen­den­cy on a pseu­do-­path, like&nbsp;this:</p> 
 <pre class="code text"><a name="rest_code_407aa6cdd15d45abbffd460df7d9a261-1"></a>####MAGIC####CONFIG:OPTIONNAME
</pre>
<p>Then, when­ev­er the  <tt class="docutils literal">OP­TION­NAME</tt>  op­tion is changed in con­f.py, the file will be&nbsp;re­built.</p> 
 <p>If your di­rec­tive de­pends or may de­pend on the whole time­line (like the
 <tt class="docutils literal"><span class="pre">post-list</span></tt>  di­rec­tive, where adding new posts to the site could make it
stale), you should record a de­pen­den­cy on the pseu­do-­path
 <tt class="docutils literal"><span class="pre">####­­MAG­IC####­­TIME­­LINE</span></tt>.</p> 
 </div>
<div class="section" id="markdownextension-plugins">
<h3><a class="toc-backref" href="#id7">MarkdownExtension&nbsp;Plugins</a></h3>
<p>Im­ple­ment Mark­down ex­ten­sion­s, see  <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/compile/markdown/mdx_nikola.py">mdx_niko­la.py</a>  for a sim­ple&nbsp;ex­am­ple.</p> 
 <p>Note that Python mark­down ex­ten­sions are of­ten al­so avail­able as sep­a­rate
­pack­ages. This is on­ly meant to ship ex­ten­sions along with&nbsp;Niko­la.</p> 
 </div>
<div class="section" id="signalhandler-plugins">
<h3><a class="toc-backref" href="#id8">SignalHandler&nbsp;Plugins</a></h3>
<p>These plug­ins ex­tend the  <tt class="docutils literal">Sig­nal­Han­dler</tt>  class and con­nect to one or more
sig­nals via  <a class="reference external" href="http://pythonhosted.org/blinker/">blink­er</a>.</p> 
 <p>The eas­i­est way to do this is to reim­ple­ment  <tt class="docutils literal">set_site()</tt>  and just con­nect to
what­ev­er sig­nals you want&nbsp;there.</p> 
 <p>Cur­rent­ly Niko­la emits the fol­low­ing&nbsp;sig­nal­s:</p> 
 <dl class="docutils">
<dt><tt class="docutils literal">sighandlers_loaded</tt></dt>
<dd>Right after SignalHandler plugin&nbsp;activation.</dd>
<dt><tt class="docutils literal">initialized</tt></dt>
<dd>When all tasks are&nbsp;loaded.</dd>
<dt><tt class="docutils literal">configured</tt></dt>
<dd>When all the configuration file is processed. Note that plugins are activated before this is&nbsp;emitted.</dd>
<dt><tt class="docutils literal">scanned</tt></dt>
<dd>After posts are&nbsp;scanned.</dd>
<dt>
<tt class="docutils literal">new_post</tt> / <tt class="docutils literal">new_page</tt>
</dt>
<dd>When a new post is created, using the <tt class="docutils literal">nikola new_post</tt>/<tt class="docutils literal">nikola new_page</tt> commands.  The signal
data contains the path of the file, and the metadata file (if there is&nbsp;one).</dd>
<dt>
<tt class="docutils literal">existing_post</tt> / <tt class="docutils literal">existing_page</tt>
</dt>
<dd>When a new post fails to be created due to a title conflict. Contains the same data as <tt class="docutils literal">new_post</tt>.</dd>
<dt><tt class="docutils literal">deployed</tt></dt>
<dd>
<p class="first">When the  <tt class="docutils literal">niko­la de­ploy</tt>  com­mand is run, and there is at least one new
en­try/­post since  <tt class="docutils literal">last_de­ploy</tt>.  The sig­nal da­ta is of the&nbsp;for­m:</p> 
 <pre class="last literal-block">
{
 'last_deploy: # datetime object for the last deployed time,
 'new_deploy': # datetime object for the current deployed time,
 'clean': # whether there was a record of a last deployment,
 'deployed': # all files deployed after the last deploy,
 'undeployed': # all files not deployed since they are either future posts/drafts
}
</pre>
</dd>
<dt><tt class="docutils literal">compiled</tt></dt>
<dd>
<p class="first">When a post/­page is com­piled from its source to htm­l, be­fore any­thing else is done with it.  The sig­nal
­da­ta is in the&nbsp;for­m:</p> 
 <pre class="last literal-block">
{
 'source': # the path to the source file
 'dest': # the path to the cache file for the post/page
 'post': # the Post object for the post/page
}
</pre>
</dd>
</dl>
<p>One ex­am­ple is the  <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v6/deploy_hooks">de­ploy_hooks&nbsp;plug­in.</a></p> 
 </div>
<div class="section" id="configplugin-plugins">
<h3><a class="toc-backref" href="#id9">ConfigPlugin&nbsp;Plugins</a></h3>
<p>Does noth­ing speci­fic, can be used to mod­i­fy the site ob­ject (and thus the&nbsp;con­fig).</p> 
 <p>Put all the mag­ic you want in  <tt class="docutils literal">set_site()</tt>, and don’t for­get to run the one
from  <tt class="docutils literal">su­per()</tt>. Ex­am­ple  plug­in:  <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v7/navstories">navs­to­ries</a></p> 
 </div>
<div class="section" id="postscanner-plugins">
<h3><a class="toc-backref" href="#id10">PostScanner&nbsp;Plugins</a></h3>
<p>Get posts and sto­ries from &#8220;some­where&#8221; to be added to the time­line.
The on­ly cur­rent­ly ex­ist­ing plug­in of this kind reads them from&nbsp;disk.</p> 
 </div>
</div>
<div class="section" id="plugin-index">
<h2><a class="toc-backref" href="#id11">Plugin&nbsp;Index</a></h2>
<p>There is a  <a class="reference external" href="https://plugins.getnikola.com/">plug­in in­dex</a>, which stores al­l
of the plug­ins for Niko­la peo­ple want­ed to share with the&nbsp;world.</p> 
 <p>You may want to read the  <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">README for the In­dex</a>  if you want to
pub­lish your pack­age&nbsp;there.</p> 
 </div>
<div class="section" id="path-link-resolution-mechanism">
<h2><a class="toc-backref" href="#id12">Path/Link Resolution&nbsp;Mechanism</a></h2>
<p>Any plug­in can reg­is­ter a func­tion us­ing  <tt class="docutils literal">Niko­la.reg­is­ter_­path_han­dler</tt>  to
al­low res­o­lu­tion of paths and links. These are use­ful for tem­plates, which
­can ac­cess them via  <tt class="docutils literal">_link</tt>.</p> 
 <p>For ex­am­ple, you can al­ways get a link to the path for the feed of the &#8220;foo&#8221; tag
­by us­ing  <tt class="docutils literal"><span class="pre">_link('­­tag_rss',</span>   'foo')</tt>  or the  <tt class="docutils literal"><span class="pre">link://­­tag_rss/­­foo</span></tt>  URL.</p> 
 <p>Here&#8217;s the rel­e­vant code from the tag&nbsp;plug­in.</p> 
 <pre class="code python"><a name="rest_code_04d8e1ea4cc7417294109bd681a13928-1"></a><span class="c1"># In set_site</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-2"></a><span class="n">site</span><span class="o">.</span><span class="n">register_path_handler</span><span class="p">(</span><span class="s1">'tag_rss'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_rss_path</span><span class="p">)</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-3"></a>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-4"></a><span class="c1"># And these always take name and lang as arguments and returl a list of</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-5"></a><span class="c1"># path elements.</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-6"></a><span class="k">def</span> <span class="nf">tag_rss_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="p">):</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-7"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'TRANSLATIONS'</span><span class="p">][</span><span class="n">lang</span><span class="p">],</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-8"></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'TAG_PATH'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">slugify_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span> <span class="o">+</span> <span class="s2">".xml"</span><span class="p">]</span> <span class="k">if</span>
<a name="rest_code_04d8e1ea4cc7417294109bd681a13928-9"></a>            <span class="n">_f</span><span class="p">]</span>
</pre>
</div>
<div class="section" id="template-hooks">
<h2><a class="toc-backref" href="#id13">Template&nbsp;Hooks</a></h2>
<p>Plug­ins can use a hook sys­tem for adding stuff in­to tem­plates.  In or­der to use
it, a plug­in must reg­is­ter it­self.  The fol­low­ing hooks cur­rent­ly&nbsp;ex­ist:</p> 
 <ul class="simple">
<li>
<tt class="docutils literal">ex­tra_­head</tt>  (not equal to the con­fig&nbsp;op­tion!)</li> 
 <li>
<tt class="docutils literal">body_end</tt>  (not equal to the con­fig&nbsp;op­tion!)</li> 
 <li><tt class="docutils literal">page_­head­er</tt></li> 
 <li><tt class="docutils literal">menu</tt></li> 
 <li>
<tt class="docutils literal">menu_alt</tt>  (right-­side menu in boot­strap, af­ter  <tt class="docutils literal">menu</tt>  in&nbsp;base)</li> 
 <li><tt class="docutils literal">page_­foot­er</tt></li> 
 </ul>
<p>For ex­am­ple, in or­der to reg­is­ter a script in­to  <tt class="docutils literal">ex­tra_­head</tt>:</p> 
 <pre class="code python"><a name="rest_code_c9c86d4d9ac04f13970708053ba38c80-1"></a><span class="c1"># In set_site</span>
<a name="rest_code_c9c86d4d9ac04f13970708053ba38c80-2"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s1">'extra_head'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'&lt;script src="/assets/js/fancyplugin.js"&gt;'</span><span class="p">)</span>
</pre>
<p>There is al­so an­oth­er API avail­able.  It al­lows use of dy­nam­i­cal­ly gen­er­at­ed&nbsp;HTM­L:</p> 
 <pre class="code python"><a name="rest_code_6355be86410e446480c0e8edb9d6529c-1"></a><span class="c1"># In set_site</span>
<a name="rest_code_6355be86410e446480c0e8edb9d6529c-2"></a><span class="k">def</span> <span class="nf">generate_html_bit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">'js'</span><span class="p">):</span>
<a name="rest_code_6355be86410e446480c0e8edb9d6529c-3"></a>    <span class="k">return</span> <span class="s1">'&lt;script src="/assets/{t}/{n}.{t}"&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">ftype</span><span class="p">)</span>
<a name="rest_code_6355be86410e446480c0e8edb9d6529c-4"></a>
<a name="rest_code_6355be86410e446480c0e8edb9d6529c-5"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s1">'extra_head'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generate_html_bit</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">'fancyplugin'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'js'</span><span class="p">)</span>
</pre>
<p>The sec­ond ar­gu­ment to  <tt class="docutils literal">ap­pend()</tt>  is used to de­ter­mine whether the func­tion
needs ac­cess to the cur­rent tem­plate con­text and the site.  If it is set to
 <tt class="docutils literal">True</tt>, the func­tion will al­so re­ceive  <tt class="docutils literal">site</tt>  and  <tt class="docutils literal">con­text</tt>  key­word
ar­gu­ments.  Ex­am­ple&nbsp;use:</p> 
 <pre class="code python"><a name="rest_code_d2fccc900bb54116852e166f25d02065-1"></a><span class="c1"># In set_site</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-2"></a><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">endswith</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-3"></a>    <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'en'</span><span class="p">:</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-4"></a>        <span class="n">greet</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">'Hello'</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-5"></a>    <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'es'</span><span class="p">:</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-6"></a>        <span class="n">greet</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">'¡Hola'</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-7"></a>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-8"></a>    <span class="n">t</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">' BLOG_TITLE = {0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'BLOG_TITLE'</span><span class="p">](</span><span class="n">context</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]))</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-9"></a>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-10"></a>    <span class="k">return</span> <span class="sa">u</span><span class="s1">'&lt;h3&gt;{greet} {addr}{endswith}&lt;/h3&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greet</span><span class="o">=</span><span class="n">greet</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="n">addr</span><span class="p">,</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-11"></a>    <span class="n">endswith</span><span class="o">=</span><span class="n">endswith</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-12"></a>
<a name="rest_code_d2fccc900bb54116852e166f25d02065-13"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s1">'page_header'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="sa">u</span><span class="s1">'Nikola Tesla'</span><span class="p">,</span> <span class="n">endswith</span><span class="o">=</span><span class="sa">u</span><span class="s1">'!'</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="shortcodes">
<h2><a class="toc-backref" href="#id14">Shortcodes</a></h2>
<p>Some (hope­ful­ly al­l) markup com­pil­ers sup­port short­codes in these&nbsp;form­s:</p> 
 <pre class="literal-block">
{{% foo %}}  # No arguments
{{% foo bar %}}  # One argument, containing "bar"
{{% foo bar baz=bat %}}  # Two arguments, one containing "bar", one called "baz" containing "bat"

{{% foo %}}Some text{{% /foo %}}  # one argument called "data" containing "Some text"
</pre>
<p>So, if you are cre­at­ing a plug­in that gen­er­ates markup, it may be a good idea
­to reg­is­ter it as a short­code in ad­di­tion of to re­struc­tured text di­rec­tive or
­mark­down ex­ten­sion, thus mak­ing it avail­able to all markup&nbsp;for­mat­s.</p> 
 <p>To im­ple­ment your own short­codes from a plug­in, you can cre­ate a plug­in in­her­it­ing  <tt class="docutils literal">Short­code­Plu­g­in</tt>  and cal­l
 <tt class="docutils literal">Niko­la.reg­is­ter_short­code(­name, func)</tt>  with the fol­low­ing&nbsp;ar­gu­ments:</p> 
 <dl class="docutils">
<dt>
<tt class="docutils literal">name</tt>:</dt>
<dd>Name of the shortcode (&#8220;foo&#8221; in the examples&nbsp;above)</dd>
<dt>
<tt class="docutils literal">func</tt>:</dt>
<dd>A function that will handle the&nbsp;shortcode</dd>
</dl>
<p>The short­code han­dler  <strong>must</strong>  ac­cept the fol­low­ing named ar­gu­ments (or
­vari­able key­word&nbsp;ar­gu­ments):</p> 
 <dl class="docutils">
<dt>
<tt class="docutils literal">site</tt>:</dt>
<dd>An instance of the Nikola class, to access site&nbsp;state</dd>
<dt>
<tt class="docutils literal">data</tt>:</dt>
<dd>If the shortcut is used as opening/closing tags, it will be the text
between them, otherwise <tt class="docutils literal">None</tt>.</dd>
</dl>
<p>If the short­code tag has ar­gu­ments of the form  <tt class="docutils literal">foo=bar</tt>  they will be
­passed as named ar­gu­ments. Ev­ery­thing else will be passed as po­si­tion­al
ar­gu­ments in the func­tion&nbsp;cal­l.</p> 
 <p>So, for&nbsp;ex­am­ple:</p> 
 <pre class="literal-block">
{{% foo bar baz=bat beep %}}Some text{{% /foo %}}
</pre>
<p>As­sum­ing you reg­is­tered  <tt class="docutils literal">foo_han­dler</tt>  as the han­dler func­tion for the
short­code named  <tt class="docutils literal">foo</tt>, this will re­sult in the fol­low­ing call when the above
short­code is&nbsp;en­coun­tered:</p> 
 <pre class="literal-block">
foo_handler("bar", "beep", baz="bat", data="Some text", site=whatever)
</pre>
<div class="section" id="template-based-shortcodes">
<h3><a class="toc-backref" href="#id15">Template-based&nbsp;Shortcodes</a></h3>
<p>An­oth­er way to de­fine a new short­code is to add a tem­plate file to the
 <tt class="docutils literal">short­codes</tt>  di­rec­to­ry of your site. The tem­plate file must have the
short­code name as the base­name and the ex­ten­sion  <tt class="docutils literal">.tm­pl</tt>. For ex­am­ple, if you
want to add a new short­code named  <tt class="docutils literal">foo</tt>, cre­ate the tem­plate file as
 <tt class="docutils literal">short­codes/­foo.tm­pl</tt>.</p> 
 <p>When the short­code is en­coun­tered, the match­ing tem­plate will be ren­dered with­
its con­text pro­vid­ed by the ar­gu­ments giv­en in the short­code. Key­word ar­gu­ments
are passed di­rect­ly, i.e. the key be­comes the vari­able name in the tem­plate
­names­pace with a match­ing string val­ue. Non-key­word ar­gu­ments are passed as
string val­ues in a tu­ple named  <tt class="docutils literal">_args</tt>. As for nor­mal short­codes with a
han­dler func­tion,  <tt class="docutils literal">site</tt>  and  <tt class="docutils literal">da­ta</tt>  will be added to the key­word&nbsp;ar­gu­ments.</p> 
 <p>Ex­am­ple:</p> 
 <p>The fol­low­ing&nbsp;short­code:</p> 
 <pre class="literal-block">
{{% foo bar="baz" spam %}}
</pre>
<p>With a tem­plate in  <tt class="docutils literal">short­codes/­foo.tm­pl</tt>  with this con­tent (us­ing Jin­ja2
syn­tax in this&nbsp;ex­am­ple):</p> 
 <pre class="literal-block">
&lt;div class="{{ _args[0] if _args else 'ham' }}"&gt;{{ bar }}&lt;/div&gt;
</pre>
<p>Will re­sult in this&nbsp;out­put:</p> 
 <pre class="literal-block">
&lt;div class="spam"&gt;baz&lt;/div&gt;
</pre>
</div>
</div>
<div class="section" id="state-and-cache">
<h2><a class="toc-backref" href="#id16">State and&nbsp;Cache</a></h2>
<p>Some­times your plug­ins will need to cache things to speed up fur­ther ac­tion­s. Here are the con­ven­tions for&nbsp;that:</p> 
 <ul class="simple">
<li>If it&#8217;s a file, put it some­where in  <tt class="docutils literal"><span class="pre">`self.site.­­con­­fig['­­CACHE_­­FOLD­ER']`</span></tt>  (de­faults to  <tt class="docutils literal">`cache/`</tt>.</li> 
 <li>If it&#8217;s a val­ue, use  <tt class="docutils literal">`self.site.­cache.set(key, val­ue)`</tt>  to set it and  <tt class="docutils literal">`self.site.­cache.get(key)`</tt>  to get it.
The key should be a string, the val­ue should be json-en­cod­able (so, be care­ful with date­time&nbsp;ob­ject­s)</li> 
 </ul>
<p>The val­ues and files you store there can  <strong>and will</strong>  be delet­ed some­times by the us­er. They should al­ways be
things you can re­con­struct with­out los­sage. They are&nbsp;throw­aways.</p> 
 <p>On the oth­er hand, some­times you want to save some­thing that is  <strong>not</strong>  a throw­away. These are things that may
change the out­put, so the us­er should not delete them. We call that  <strong>state</strong>. To save&nbsp;state:</p> 
 <ul class="simple">
<li>If it&#8217;s a file, put it some­where in the work­ing di­rec­to­ry. Try not to do that&nbsp;please.</li> 
 <li>If it&#8217;s a val­ue, use  <tt class="docutils literal">`self.site.s­tate.set(key, val­ue)`</tt>  to set it and  <tt class="docutils literal">`self.s­tate.­cache.get(key)`</tt>  to get it.
The key should be a string, the val­ue should be json-en­cod­able (so, be care­ful with date­time&nbsp;ob­ject­s)</li> 
 </ul>
<p>The  <tt class="docutils literal">`cache`</tt>  and  <tt class="docutils literal">`s­tate`</tt>  ob­jects are rather sim­plis­tic, and that&#8217;s in­ten­tion­al. They have no de­fault val­ues: if
the key is not there, you will get  <tt class="docutils literal">`None`</tt>  and like it. They are meant to be both thread­safe, but hey, who can
guar­an­tee that sort of&nbsp;thing?</p> 
 <p>There are no sec­tion­s, and no ac­cess pro­tec­tion, so let&#8217;s not use it to store pass­words and such. Use&nbsp;re­spon­si­bly.</p> 
 </div>
</div>
    </div>
    

</article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:webmaster@antipodae.fr">webmaster</a> — Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> — <a href="../legal/index.html">legal stuff</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script type="text/javascript" src="../../assets/js/jquery.sharrre-1.3.4.min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});
        $('#share').sharrre({
        share: {
            googlePlus: true,
            facebook: true,
            twitter: true
        }, 
        buttons: {
            googlePlus: {size: 'tall', annotation:'bubble'},
            facebook: {layout: 'box_count'},
            twitter: {count: 'vertical', via:'_JulienH' }
        },
        hover: function(api, options){
            $(api.element).find('.buttons').show();
        },
        hide: function(api, options){
            $(api.element).find('.buttons').hide();
        },
        enableTracking: true,
        urlCurl: ""
        });
    </script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>